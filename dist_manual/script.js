(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();const at={disk:function(e,t,n){this.beginPath(),this.arc(e,t,n,0,Math.PI*2),this.fill()},circle:function(e,t,n){this.beginPath(),this.arc(e,t,n,0,Math.PI*2),this.stroke()},lineDir:function(e,t,n,i){this.beginPath(),this.moveTo(e,t),this.lineTo(e+n.x*i,t+n.y*i),this.stroke()},line:function(e,t,n,i){this.beginPath(),this.moveTo(e,t),this.lineTo(n,i),this.stroke()},fontSize:function(e){this.font=e+"em Calibri"},textCenter:function(){this.textAlign="center",this.textBaseline="middle"},bubbleGradient:function(e,t,n,i){const o=this.createRadialGradient(e+n/2,t-n/2,n/13,e,t,n);o.addColorStop(0,"white"),o.addColorStop(1,i),this.fillStyle=o}};function ht(e){for(const[t,n]of Object.entries(at))e[t]=n.bind(e)}const r={x:0,y:0,down:!1,up:!1,pressed:!1,wheel:0};let E=[];function dt(e){e.addEventListener("mousedown",t=>{r.x=t.offsetX,r.y=t.offsetY,r.down=!0,r.pressed=!0}),e.addEventListener("mouseup",t=>{r.x=t.offsetX,r.y=t.offsetY,r.up=!0,r.pressed=!1}),e.addEventListener("mousemove",t=>{r.x=t.offsetX,r.y=t.offsetY}),e.addEventListener("wheel",t=>{r.wheel=t.deltaY}),e.addEventListener("keydown",t=>{E[t.key]||(E[t.key]={}),E[t.key].down=!0,E[t.key].pressed=!0;const n=Q.keyDown[t.key];n&&n()}),e.addEventListener("keyup",t=>{E[t.key].up=!0,E[t.key].pressed=!1;const n=Q.keyUp[t.key];n&&n()})}function ct(){r.up=!1,r.down=!1,r.wheel=0;for(const e of E)e.up=!1,e.down=!1}let Q={};function he(e,t){Q.keyUp[e]=t}function Ae(){Q={keyDown:{},keyUp:{}}}Ae();function M(e,t){return Math.floor(Math.random()*(t-e)+e)}function Ge(e,t,n){return e<t?t:e>n?n:e}function d(e,t){return{x:e,y:t}}function pt(e){return(e.x**2+e.y**2)**(1/2)}function yt(e,t,n,i){return pt(d(n-e,i-t))}function J(e,t){if(typeof e=="object"&&(t=e.y,e=e.y),e==0||t==0)return d(0,0);const n=Math.sqrt(e*e+t*t);return d(e/n,t/n)}function de(e,t){const n=J(e.x,e.y);switch(typeof t){case"object":return{x:n.x*t.x,y:n.y*t.y};case"number":return{x:n.x*t,y:n.y*t};default:return null}}function j(e){return`hsla(${e}, 100%, 80%, 1)`}function gt(...e){return bt.play(...e)}const bt={volume:.3,sampleRate:44100,x:new AudioContext,play:function(...e){return this.playSamples(this.buildSamples(...e))},playSamples:function(...e){const t=this.x.createBuffer(e.length,e[0].length,this.sampleRate),n=this.x.createBufferSource();return e.map((i,o)=>t.getChannelData(o).set(i)),n.buffer=t,n.connect(this.x.destination),n.start(),n},buildSamples:function(e=1,t=.05,n=220,i=0,o=0,l=.1,a=0,h=1,P=0,oe=0,le=0,xe=0,_=0,Qe=0,ve=0,Je=0,S=0,se=1,V=0,ke=0,q=0){let m=Math.PI*2,re=ut=>ut<0?-1:1,p=this.sampleRate,et=P*=500*m/p/p,ze=n*=(1+t*2*Math.random()-t)*m/p,fe=[],C=0,tt=0,c=0,X=1,nt=0,it=0,w=0,ue,$,ot=2,Le=m*Math.abs(q)*2/p,ae=Math.cos(Le),Te=Math.sin(Le)/2/ot,H=1+Te,lt=-2*ae/H,st=(1-Te)/H,Oe=(1+re(q)*ae)/2/H,rt=-(re(q)+ae)/H,ft=Oe,Ee=0,Re=0,Be=0,Fe=0;for(i=i*p+9,V*=p,o*=p,l*=p,S*=p,oe*=500*m/p**3,ve*=m/p,le*=m/p,xe*=p,_=_*p|0,e*=this.volume,$=i+V+o+l+S|0;c<$;fe[c++]=w*e)++it%(Je*100|0)||(w=a?a>1?a>2?a>3?Math.sin(C*C):Math.max(Math.min(Math.tan(C),1),-1):1-(2*C/m%2+2)%2:1-4*Math.abs(Math.round(C/m)-C/m):Math.sin(C),w=(_?1-ke+ke*Math.sin(m*c/_):1)*re(w)*Math.abs(w)**h*(c<i?c/i:c<i+V?1-(c-i)/V*(1-se):c<i+V+o?se:c<$-S?($-c-S)/l*se:0),w=S?w/2+(S>c?0:(c<$-S?1:($-c)/S)*fe[c-S|0]/2/e):w,q&&(w=Fe=ft*Ee+rt*(Ee=Re)+Oe*(Re=w)-st*Be-lt*(Be=Fe))),ue=(n+=P+=oe)*Math.cos(ve*tt++),C+=ue+ue*Qe*Math.sin(c**5),X&&++X>xe&&(n+=le,ze+=le,X=0),_&&!(++nt%_)&&(n=ze,P=et,X=X||1);return fe},getNote:function(e=0,t=440){return t*2**(e/12)}},mt={interact:[.4,0,55,.03,.01,.03,4,2,,6,-353,.11,,,,,,.55,.03,,-604],shoot:[,,354,,,0,,3.6,-6,5,,,,,,,,0,.19],explode:[.3,.3,,.02,.27,.41,,3.7,7,,,,.21,,,.3,,.4,.27]};let ce=!1;function wt(){ce=!ce}function A(e){ce||gt(...mt[e])}let D=[];function St(e){const t=M(30,200);D.push({x:M(0,s.width),y:-t,size:t,hue:M(0,360),speed:M(20,150)})}function De(e){for(let t=0;t<D.length;t++){const n=D[t];e.bubbleGradient(n.x,n.y,n.size,j(n.hue)),e.disk(n.x,n.y,n.size)}e.fillStyle="#FFFFFFCC",e.fillRect(0,0,s.width,s.height)}function Ie(e){for(let t=D.length-1;t>0;t--){const n=D[t];n.y+=n.speed*e,n.y>s.height+n.size&&D.splice(t,1)}Math.random()<.05&&St()}function Mt(e){e.fontSize(8),e.textCenter(),e.fillText("13 Bubbles",s.width/2,200),e.save(),e.translate(300,600);const t=130;W(e,0,0,t,j(180),"Play",6,!1),W(e,t*1.3,-t,60,j(90),"Easy",2)&&(A("interact"),N(I.game,{difficulty:0})),W(e,t*1.7,0,60,j(50),"Normal",2)&&(A("interact"),N(I.game,{difficulty:1})),W(e,t*1.3,t,60,j(0),"Hard",2)&&(A("interact"),N(I.game,{difficulty:2})),e.restore(),e.fontSize(2),e.fillText("Made by @NoNiMad",s.width/2,s.height-60),e.fontSize(1),e.fillText("Using zzfx(m)",s.width/2,s.height-30)}function W(e,t,n,i,o,l,a,h){if(e.bubbleGradient(t,n,i,o),e.disk(t,n,i),e.fontSize(a),e.textCenter(),e.fillStyle="black",e.fillText(l,t,n),h===!1)return!1;const P=new DOMPoint(t,n).matrixTransform(e.getTransform());return!!(yt(P.x,P.y,r.x,r.y)<i&&(e.lineWidth=2,e.strokeStyle="black",e.circle(t,n,i),r.up))}function Pt(){be(Ie),ie(De),ie(Mt)}function Ct(){}const xt=Object.freeze(Object.defineProperty({__proto__:null,onEnter:Pt,onLeave:Ct},Symbol.toStringTag,{value:"Module"})),u=52,z=13,y=39,Ne=.39,_e=13*80,vt=13*50;let x,T,f,me,B,F,b,U,G,Z,pe,L,ee,ye,ge,k,R,te;function we(){return M(0,3)==0?-M(1,7):M(1,8)}function kt(){return{value:we(),color:M(0,T.length)}}function Ue(){Ve(),f.unshift([]),me+=1;for(let e=0;e<z;e++)f[0].push(kt());Me((e,t,n)=>{n.gridPos=d(e,t),n.pos=Xe(n.gridPos)})}function Ve(){for(let e=f.length-1;e>=0;e--){for(let t=0;t<z;t++)if(f[e][t]!==null)return;f.splice(e,1)}}function Xe(e){const t=u*(.5+e.y*7/8),n=y+(e.x+.5+Se(e.y)/2)*u;return d(n,t)}function Ye(e,t){const n=Math.floor(e.y*8/(u*7)-.5714285714285714+.5),i=Math.floor((e.x-y)/u-Se(n)/2);return!t&&(i<0||i>=z||n<0||n>=f.length)?null:d(i,n)}function zt(e){const t=Ye(e);return t==null?null:f[t.y][t.x]}function Lt(e,t){return((e.x-t.pos.x)**2+(e.y-t.pos.y)**2)**.5}function Se(e){return(e+me)%2}function Me(e){for(let t=0;t<f.length;t++){const n=f[t];for(let i=0;i<n.length;i++){let o=n[i];if(o!==null&&e(i,t,o)===!1)return}}}function qe(e){let t=e.gridPos.x,n=e.gridPos.y,i=[],o=Se(n)==0,l=o?-1:0;return t>0&&i.push(f[n][t-1]),t<z-1&&i.push(f[n][t+1]),n>0&&((t>0||!o)&&i.push(f[n-1][t+l]),(t<z-1||o)&&i.push(f[n-1][t+1+l])),n<f.length-1&&((t>0||!o)&&i.push(f[n+1][t+l]),(t<z-1||o)&&i.push(f[n+1][t+1+l])),i.filter(a=>a!=null)}function He(e){let t=new Set,n=[e];for(;n.length!=0;)n=n.flatMap(i=>(t.add(i),qe(i).filter(o=>o.color===e.color&&!t.has(o))));return[...t]}function Tt(){const e=new Set(f.flatMap(t=>t.filter(n=>n!=null)));for(let t of f[0]){if(t==null||!e.has(t))continue;let n=new Set([t]),i,o;for(;n.size!=0;){i=n.values().next().value,e.delete(i),n.delete(i),o=qe(i);for(let l=0;l<o.length;l++)e.has(o[l])&&n.add(o[l])}}return[...e]}function Ot(e){const t=e.createLinearGradient(y,0,0,0);t.addColorStop(0,"#00000000"),t.addColorStop(1,T[G]),e.fillStyle=t,e.fillRect(0,0,y,s.height);const n=e.createLinearGradient(s.width-y,0,s.width,0);if(n.addColorStop(0,"#00000000"),n.addColorStop(1,T[G]),e.fillStyle=n,e.fillRect(s.width-y,0,s.width,s.height),e.lineWidth=1,e.line(y-1,0,y-1,s.height),e.line(s.width-y+1,0,s.width-y+1,s.height),Me((i,o,l)=>{K(e,l.pos,l)}),!R){Et(e);for(let i of U)K(e,i.pos,i);F.forEach(i=>K(e,i.pos,i)),e.textAlign="left",e.fillStyle="black",e.fillText("Score: "+te,y*1.5,s.height-u/2),Rt(e)}(R||k)&&(e.textCenter(),e.fillStyle="#FFFFFFBB",e.fillRect(0,0,s.width,s.height),e.fillStyle="black",e.fontSize(8),e.fillText(R?"Game Over!":"Paused",s.width/2,s.height/2-100),e.fontSize(4),e.fillText("Score: "+te,s.width/2,s.height/2),e.fontSize(1),e.fillText("Click anywhere to "+(R?"go back to the main menu":"resume game"),s.width/2,s.height/2+200),k&&e.fillText("Press Q to go back to the main menu",s.width/2,s.height/2+220))}function Et(e){e.lineWidth=2,e.lineDir(L.x,L.y,ee,u*2),b[0]!=null&&K(e,L,{value:b[0],color:G}),e.save(),e.translate(s.width/2,s.height);for(let t=1;t<b.length;t++)e.fillStyle="black",e.fillText(b[t],t*(u+13),-u/2);e.restore()}function Rt(e){if(B.length==0)return;let t=0,n=0,i=0;B.forEach(a=>{t+=a.value,i+=a.pos.x,n=Math.max(n,a.pos.y)});let o={x:i/B.length,y:n+u};e.fillStyle="black",e.disk(o.x,o.y,u/2),e.fontSize(1.8),e.textCenter();const l=t%13;l>0?e.fillText(`${t-l} < ${t-l+13}`,o.x,o.y+u):l<0&&e.fillText(`${t-l-13} < ${t-l}`,o.x,o.y+u),e.fillStyle="white",e.fillText(t,o.x,o.y)}function K(e,t,n){e.bubbleGradient(t.x,t.y,u/2,T[n.color]),e.disk(t.x,t.y,u/2),B.includes(n)&&(e.lineWidth=2,e.strokeStyle="black",e.circle(t.x,t.y,u/2-1)),e.fontSize(1.8),e.textCenter(),e.fillStyle="black",e.fillText(n.value,t.x,t.y)}function Bt(e){if(R){r.down&&N(I.menu);return}if(k){r.down&&(k=!1);return}for(let t=F.length-1;t>=0;t--){const n=F[t];if(n.pos.x<-u||n.pos.x>s.width+u||n.pos.y>s.height+u){F.splice(t,1),_t(n);continue}n.speed.y+=vt*e,n.pos.x+=n.speed.x*e,n.pos.y+=n.speed.y*e}ee=J(r.x-L.x,Math.min(r.y,L.y-13)-L.y),Gt(e),Ft()}function Ft(){const e=zt(d(r.x,r.y));B=e!=null?He(e):[]}function Gt(e){if(r.wheel!=0){let t=r.wheel>0?-1:1,n=G+t;n>=T.length?n=0:n<0&&(n=T.length-1),G=n,A("interact")}Z>Ne?(b[0]==null&&(b.shift(),b.push(we())),r.down&&(U.push({value:b[0],color:G,pos:{...L},speed:d(ee.x*_e,ee.y*_e)}),b[0]=null,Z=0,pe++,pe%5==0&&(Ue(),f.length>26&&We()),A("shoot"))):Z+=e;for(let t of U)if(t.pos.x+=t.speed.x*e,t.pos.y+=t.speed.y*e,t.pos.x<ye&&(t.pos.x=ye,t.speed.x=-t.speed.x),t.pos.x>ge&&(t.pos.x=ge,t.speed.x=-t.speed.x),t.pos.y<u/2){const n=u/2-t.pos.y,i=J(t.speed),o=d(t.pos.x-i.x*n,t.pos.y-i.y*n);$e(t,o)}else Me((n,i,o)=>{const l=Lt(t.pos,o);if(l<=u){const a=u-l,h=J(t.speed),P=d(t.pos.x-h.x*a,t.pos.y-h.y*a);return $e(t,P),!1}})}function $e(e,t){U.splice(U.indexOf(e),1);const n=Ye(t,!0);if(n.y>25){We();return}n.x=Ge(n.x,0,z-1),n.y=Ge(n.y,0,f.length),n.y==f.length&&f.push(new Array(z).fill(null)),e.gridPos=n,f[n.y][n.x]=e;const i=He(e),o=i.reduce((l,a)=>l+a.value,0);if(o%13==0){const l=Math.min(Math.abs(o)/13,1);i.forEach(h=>{f[h.gridPos.y][h.gridPos.x]=null,h.speed=h==e?de(h.speed,d(130,260)):de(d(h.pos.x-e.pos.x,h.pos.y-e.pos.y),d(130,260)),delete h.gridPos,h.multiplier=l}),F.push(...i);const a=Tt();a.forEach(h=>{f[h.gridPos.y][h.gridPos.x]=null,h.speed=de(d(h.pos.x-e.pos.x,h.pos.y-e.pos.y),d(10,260)),delete h.gridPos,h.multiplier=l}),F.push(...a),A("explode"),Ve()}else e.pos=Xe(n)}function _t(e){te+=Math.abs(e.value*e.multiplier)}function We(){R=!0,B=[]}function $t(e){if(be(Ie),ie(De),ie(Ot),be(Bt),he("Escape",()=>{k=!k}),he("q",()=>{k&&N(I.menu)}),he("m",()=>{wt()}),zzfxM([[,0,400]],[[[,6,,8,,10,,,,12,,,,8,,,14,,,,]]],[0,0],void 0,{title:"s",instruments:["0"],patterns:["0"]}),f=[],B=[],F=[],me=0,U=[],G=0,pe=0,Z=Ne,L=d(s.width/2,s.height-u),ye=y+u/2,ge=s.width-y-u/2,R=!1,k=!1,te=0,e.difficulty!==void 0)switch(e.difficulty){case 0:x={initialLines:3,numberOfColors:2,nextValuesCount:5};break;case 1:x={initialLines:5,numberOfColors:3,nextValuesCount:4};break;case 2:x={initialLines:7,numberOfColors:4,nextValuesCount:3};break}else x=e.gameConfig;T=[];const t=M(0,360);for(let n=0;n<x.numberOfColors;n++)T.push(j(t+n*360/x.numberOfColors));for(let n=0;n<x.initialLines;n++)Ue();b=[];for(let n=0;n<x.nextValuesCount;n++)b.push(we())}const jt=Object.freeze(Object.defineProperty({__proto__:null,onEnter:$t},Symbol.toStringTag,{value:"Module"})),At=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),s={};let g,Y=1;function Dt(){const e=document.querySelector("canvas");s.element=e,s.boundingRect=e.getBoundingClientRect(),s.width=e.width,s.height=e.height,g=e.getContext("2d"),dt(e),ht(g),v=performance.now(),ne=v-Ze,window.addEventListener("resize",je),je(),N(I.menu),Ke()}function je(){Y=Math.min(window.innerHeight/1280,1),s.element.width=780*Y,s.element.height=1280*Y}const It=144,Ze=1e3/It;let v,ne;function Ke(){let e=v;v=performance.now();let t=v-e;Ut(t/1e3),v-ne>=Ze&&(Nt(),ne=v),ct(),requestAnimationFrame(Ke)}function Nt(){g.save(),g.scale(Y,Y),g.fillStyle="white",g.fillRect(0,0,s.width,s.height),g.fillStyle="black",g.fillText(Math.floor(1e3/(v-ne)),10,20),Pe.forEach(e=>{g.save(),e(g),g.restore()}),g.restore()}function Ut(e){Ce.forEach(t=>t(e))}let Pe=[],Ce=[];function ie(e){Pe.push(e)}function be(e){Ce.push(e)}const I={menu:xt,game:jt,customGame:At};let O=null;function N(e,t){var n;(n=O==null?void 0:O.onLeave)==null||n.call(O),Pe=[],Ce=[],Ae(),O=e,O.onEnter(t)}window.addEventListener("load",Dt);
